<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>HR V2 å·¥ä½œç«™</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f6; }
        body { font-family: "Microsoft JhengHei"; background: var(--bg); padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .staff-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .staff-btn { background: white; border: 2px solid #ddd; padding: 15px; border-radius: 10px; cursor: pointer; text-align: center; }
        .staff-btn.active { border-color: var(--accent); background: #e3f2fd; font-weight: bold; }
        .tab-btn { padding: 10px 25px; border: none; cursor: pointer; font-size: 1rem; margin-right: 5px; border-radius: 5px; }
        .tab-btn.active { background: var(--primary); color: white; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ‘¤ äººå“¡é¸æ“‡ (å…¨è™›æ“¬è³‡æ–™)</h2>
    <div id="staffGrid" class="staff-grid">è¼‰å…¥ä¸­...</div>
</div>

<div style="margin-bottom:15px;">
    <button id="tB" class="tab-btn active" onclick="showTab('B')">ğŸ“Š çé‡‘æ ¸å®š</button>
    <button id="tS" class="tab-btn" onclick="showTab('S')">ğŸ“ˆ è–ªè³‡æ±ºç­–(ğŸ”’)</button>
</div>

<div id="paneB" class="card">
    <h3>çé‡‘æ ¸å®šå€</h3>
    <div id="bonusInfo">è«‹å…ˆé»é¸äººå“¡</div>
</div>

<div id="paneS" class="card" style="display:none;">
    <h3>è–ªè³‡æ±ºç­–æ­·ç¨‹</h3>
    <div id="salaryInfo">éœ€å¯†ç¢¼é©—è­‰</div>
</div>

<script>
    // ğŸ’¡ å‹™å¿…æ›¿æ›ç‚ºæ‚¨æœ€æ–°çš„ GAS ç¶²å€
    const API_URL = "https://script.google.com/macros/s/AKfycbxmNA0AYmcKK5x4iKZz0FwujvvtS4nioZ7fjXLe-oBlaye6qRfIf_WV8gp-Fj9vZPe1OA/exec";
    
    // åˆå§‹åŒ–æŠ“å–äººå“¡
    window.onload = () => callAPI({action:"getStaff"}, r => renderStaff(r.data));

    function renderStaff(data) {
        if (!data || data.length === 0) {
            document.getElementById('staffGrid').innerHTML = "ç›®å‰åå–®ä¸­æ²’æœ‰è³‡æ–™ï¼Œè«‹æª¢æŸ¥ Staff_Master åˆ†é ã€‚";
            return;
        }
        document.getElementById('staffGrid').innerHTML = data.map(s => `
            <div class="staff-btn" onclick="selectStaff(this, '${s[0]}')">
                <div style="font-size:1.2rem;">${s[0]}</div>
                <div style="font-size:0.8rem; color:gray;">${s[2]} | ${new Date(s[1]).getFullYear()}å…¥è·</div>
            </div>
        `).join('');
    }

    async function selectStaff(el, name) {
        document.querySelectorAll('.staff-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        callAPI({action:"getSalary", name:name, date:"2025-01-01"}, r => {
            document.getElementById('bonusInfo').innerHTML = `<h4>${name}</h4>ç•¶å‰è·ç­‰: ${r.rank}<br>åŸºæº–è–ªè³‡: ${r.salary}`;
        });
    }

    async function showTab(t) {
        if(t === 'S') {
            const pwd = prompt("è«‹è¼¸å…¥æœ€é«˜æ¬Šé™å¯†ç¢¼(0000)ï¼š");
            callAPI({action:"verify", pwd:pwd}, r => {
                if(r.status === "success") {
                    document.getElementById('paneB').style.display = 'none';
                    document.getElementById('paneS').style.display = 'block';
                    document.getElementById('tB').classList.remove('active');
                    document.getElementById('tS').classList.add('active');
                } else alert("å¯†ç¢¼éŒ¯èª¤");
            });
        } else {
            document.getElementById('paneS').style.display = 'none';
            document.getElementById('paneB').style.display = 'block';
            document.getElementById('tS').classList.remove('active');
            document.getElementById('tB').classList.add('active');
        }
    }

    // ğŸ’¡ å¾¹åº•ä¿®å¾© CORS çš„æ ¸å¿ƒ Fetch å¯«æ³•
    function callAPI(payload, callback) {
        fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(json => callback(json))
        .catch(err => {
            console.error("API éŒ¯èª¤:", err);
            alert("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ GAS éƒ¨ç½²æ˜¯å¦è¨­ç‚ºã€Œæ‰€æœ‰äººã€ä¸¦æ›´æ–°ç¶²å€ã€‚");
        });
    }
</script>
</body>
</html>
